!function(){"use strict";var e="undefined"==typeof window?global:window;if("function"!=typeof e.require){var t={},o={},r={},i={}.hasOwnProperty,a=/^\.\.?(\/|$)/,n=function(e,t){for(var o,r=[],i=(a.test(t)?e+"/"+t:t).split("/"),n=0,s=i.length;s>n;n++)o=i[n],".."===o?r.pop():"."!==o&&""!==o&&r.push(o);return r.join("/")},s=function(e){return e.split("/").slice(0,-1).join("/")},d=function(t){return function(o){var r=n(s(t),o);return e.require(r,t)}},l=function(e,t){var r=null;r=m&&m.createHot(e);var i={id:e,exports:{},hot:r};return o[e]=i,t(i.exports,d(e),i),i.exports},c=function(e){return r[e]?c(r[e]):e},h=function(e,t){return c(n(s(e),t))},u=function(e,r){null==r&&(r="/");var a=c(e);if(i.call(o,a))return o[a].exports;if(i.call(t,a))return l(a,t[a]);throw new Error("Cannot find module '"+e+"' from '"+r+"'")};u.alias=function(e,t){r[t]=e};var g=/\.[^.\/]+$/,p=/\/index(\.[^\/]+)?$/,f=function(e){if(g.test(e)){var t=e.replace(g,"");i.call(r,t)&&r[t].replace(g,"")!==t+"/index"||(r[t]=e)}if(p.test(e)){var o=e.replace(p,"");i.call(r,o)||(r[o]=e)}};u.register=u.define=function(e,r){if("object"==typeof e)for(var a in e)i.call(e,a)&&u.register(a,e[a]);else t[e]=r,delete o[e],f(e)},u.list=function(){var e=[];for(var o in t)i.call(t,o)&&e.push(o);return e};var m=e._hmr&&new e._hmr(h,u,t,o);u._cache=o,u.hmr=m&&m.wrap,u.brunch=!0,e.require=u}}(),function(){window;require.register("application.js",function(e,t,o){"use strict";var r=(t("jquery"),t("scripts/main")),i={init:function(){Ext.onReady(function(){r.init()})}};o.exports=i}),require.register("scripts/another.js",function(e,t,o){var r=t("jquery"),i={doSomething:function(){var e=t("templates/listOfPeople");r("#main").append(e({people:[{name:"Richard",sex:"m",dob:"1976-03-02"},{name:"Michael",sex:"M",dob:"1979-12-11"},{name:"Clare",sex:"f",dob:"1983-11-12"},{name:"Nathan",sex:"m",dob:"1966-07-07"}]}))}};o.exports=i}),require.register("scripts/cohort.js",function(e,t,o){"use strict";o.exports=function(e){this.cohortname=0!==e?e.cohortname:"Default",this.desc=0!==e?e.desc:"All patients",this.datecreated=0!==e?e.datecreated:new Date,this.bywho=0!==e?e.bywho:"Adminstrator",this.genderMale=!0,this.genderFemale=!0,this.ageMin=0,this.ageMax=200,this.weightMin=0,this.weightMax=500,this.diagnosis=-1,this.dob=new Date("1900-01-01"),this.occupation=-1,this.sep=",",this.getAjaxParams=function(){var e=this.genderMale&this.genderFemale?"0,1":this.genderMale?"1":"0";return"0,1"===e&&(e=-1),{gender:e,ageMin:this.ageMin,ageMax:this.ageMax,dob:this.dob,weightMin:this.weightMin,weightMax:this.weightMax,diagnosis:-1===this.diagnosis?-1:this.diagnosis.join(this.sep),occupation:-1===this.occupation?-1:this.occupation.join(this.sep)}}}}),require.register("scripts/cohort_define_form.js",function(e,t,o){"use strict";var r=t("scripts/local");Ext.define("DiagnosisSelectorModel",{extend:"Ext.data.Model",fields:[{name:"id",type:"number"},"name"]}),Ext.define("OccupationsSelectorModel",{extend:"Ext.data.Model",fields:[{name:"id",type:"number"},"name"]});var i=function(){var e=this;this.store=new Ext.data.Store({autoDestroy:!0,model:"DiagnosisSelectorModel",proxy:{type:"ajax",url:"diagnosis.php",reader:{type:"json"}}}),this.grid=Ext.create("Ext.grid.Panel",{xtype:"sgrid",columnLines:!0,loadMask:!0,store:e.store,columns:[{header:"Select All",dataIndex:"name",flex:1,width:150}],selType:"checkboxmodel",selModel:{injectCheckbox:0,pruneRemoved:!1}})},a=function(){var e=this;this.store=new Ext.data.Store({autoDestroy:!0,model:"OccupationsSelectorModel",proxy:{type:"ajax",url:"occupations.php",reader:{type:"json"}}}),this.grid=Ext.create("Ext.grid.Panel",{xtype:"sgrid",columnLines:!0,loadMask:!0,store:e.store,columns:[{header:"Select All",dataIndex:"name",flex:1,width:150}],selType:"checkboxmodel",selModel:{injectCheckbox:0,pruneRemoved:!1}})};o.exports={DefineTabs:function(e){var t=this;this.cohort=e,this.id=e.cohortname.replace(/ /g,"-"),this.diagnosisSelector=new i,t.diagnosisSelector.store.load(),this.occupationsSelector=new a,t.occupationsSelector.store.load();var o;this.tabs=Ext.create("Ext.tab.Panel",{activeTab:0,items:[{title:"Demographics",bodyPadding:10,items:[{xtype:"fieldset",title:"Gender",defaultType:"checkbox",layout:"hbox",items:[{boxLabel:"Male",checked:t.cohort.genderMale,name:"male",flex:1,id:"male-"+t.id},{boxLabel:"Female",checked:t.cohort.genderFemale,name:"female",flex:2,id:"female-"+t.id}]},{xtype:"fieldset",title:"Age",defaultType:"numberfield",fieldDefaults:{anchor:"100%"},items:[{fieldLabel:"Min",value:t.cohort.ageMin,step:1,minValue:0,maxValue:200,name:"ageMin",id:"ageMin-"+t.id},{fieldLabel:"Max",value:t.cohort.ageMax,minValue:0,maxValue:200,name:"ageMax",id:"ageMax-"+t.id}]},{xtype:"fieldset",title:"Date of Birth",items:[{xtype:"datefield",fieldLabel:"After",value:t.cohort.dob,name:"dob",id:"dob-"+t.id}]},{xtype:"fieldset",title:"Weight",defaultType:"numberfield",fieldDefaults:{anchor:"100%"},items:[{fieldLabel:"Min",value:t.cohort.weightMin,step:1,minValue:0,maxValue:500,name:"weightMin",id:"weightMin-"+t.id},{fieldLabel:"Max",value:t.cohort.weightMax,minValue:0,maxValue:500,name:"weightMax",id:"weightMax-"+t.id}]}]},{title:"Diagnosis",scrollable:!0,items:t.diagnosisSelector.grid,listeners:{afterrender:function(e,r){if(-1===t.cohort.diagnosis)t.diagnosisSelector.grid.getSelectionModel().selectAll();else{var i=[];for(o=0;o<t.cohort.diagnosis.length;o++)i[o]=t.diagnosisSelector.store.getById(t.cohort.diagnosis[o]);t.diagnosisSelector.grid.getSelectionModel().select(i)}}}},{title:"Occupations",scrollable:!0,items:t.occupationsSelector.grid,listeners:{afterrender:function(e,r){if(-1===t.cohort.occupation)t.occupationsSelector.grid.getSelectionModel().selectAll();else{var i=[];for(o=0;o<t.cohort.occupation.length;o++)i[o]=t.occupationsSelector.store.getById(t.cohort.occupation[o]);t.occupationsSelector.grid.getSelectionModel().select(i)}}}}],renderTo:Ext.getBody()}),this.window=new Ext.window.Window({title:t.cohort.cohortname,height:670,width:350,layout:"fit",items:t.tabs,closable:!0,modal:!0,buttons:[{text:"OK",handler:function(e){if(!Ext.getCmp("male-"+t.id).checked&&!Ext.getCmp("female-"+t.id).checked)return void Ext.Msg.alert("Cohort Selection","Please select at least one gender.");var i=[],a=[],n=t.diagnosisSelector.grid.getSelection(),s=t.occupationsSelector.grid.getSelection();if(t.diagnosisSelector.grid.rendered){if(n.length<1)return void Ext.Msg.alert("Cohort Selection","Please select diagnoses from 'Diagnosis' tab.");for(o=0;o<n.length;o++)i[o]=n[o].data.id}if(t.occupationsSelector.grid.rendered){if(s.length<1)return void Ext.Msg.alert("Occupation Selection","Please select occupations from 'Occupations' tab.");for(o=0;o<s.length;o++)a[o]=s[o].data.id}i.length>0&&(t.cohort.diagnosis=t.diagnosisSelector.store.getCount()===n.length?-1:i),a.length>0&&(t.cohort.occupation=t.occupationsSelector.store.getCount()===s.length?-1:a),t.cohort.genderMale=Ext.getCmp("male-"+t.id).checked,t.cohort.genderFemale=Ext.getCmp("female-"+t.id).checked,t.cohort.ageMin=Ext.getCmp("ageMin-"+t.id).value,t.cohort.ageMax=Ext.getCmp("ageMax-"+t.id).value,t.cohort.dob=Ext.getCmp("dob-"+t.id).value,t.cohort.weightMin=Ext.getCmp("weightMin-"+t.id).value,t.cohort.weightMax=Ext.getCmp("weightMax-"+t.id).value,r.cohorts[r.selectedCohort]=t.cohort,t.window.close(),t.window.destroy()}},{text:"Cancel",handler:function(e){t.window.close()}}]})}}}),require.register("scripts/cohort_details_counts.js",function(e,t,o){"use strict";var r=t("scripts/local");Ext.define("CountModel",{extend:"Ext.data.Model",fields:["name",{name:"count",type:"number"}]}),o.exports=function(){var e=this;this.pars=r.cohorts[r.selectedCohort].getAjaxParams(),this.pars.count="Diagnosis",this.store=Ext.create("Ext.data.Store",{autoDestroy:!0,model:"CountModel",proxy:{type:"ajax",url:"counts.php",extraParams:e.pars,reader:{type:"json"}},sorters:[{property:"userId",direction:"ASC"}]}),this.grid=Ext.create("Ext.grid.Panel",{id:"counts-grid",store:e.store,columns:[{header:"Description",dataIndex:"name",flex:1,editor:{allowBlank:!1}},{header:"Count",dataIndex:"count",xtype:"numbercolumn",format:"0",width:160,editor:{allowBlank:!1}}],tbar:[{text:e.pars.count,id:"count-sel-menu",renderTo:Ext.getBody(),menu:{defaults:{handler:function(){e.changeCount(this.text)}},items:[{text:"Diagnosis"},{text:"Occupation"},{text:"Gender"}]}}]}),this.changeCount=function(t){Ext.getCmp("count-sel-menu").setText(t);var o=r.cohorts[r.selectedCohort].getAjaxParams();o.count=t,e.store.proxy.extraParams=o,e.store.load()}}}),require.register("scripts/cohort_selector.js",function(e,t,o){"use strict";var r=t("scripts/cohort"),i=t("scripts/local"),a=t("scripts/cohort_define_form");Ext.define("CohortSelectorModel",{extend:"Ext.data.Model",fields:["cohortname","briefdesc","bywho",{name:"datecreated",type:"date",dateFormat:"d/m/Y H:i:s"}]}),o.exports=function(){var e=this;Ext.require("CohortSelectorModel"),this.store=Ext.create("Ext.data.Store",{model:"CohortSelectorModel",autoLoad:!0,proxy:{type:"memory"},data:[{cohortname:"Default",briefdesc:"All patients",bywho:"Administrator",datecreated:new Date}],sorters:[{property:"datecreated",direction:"DESC"}]});var t=Ext.create("Ext.grid.plugin.RowEditing",{clicksToMoveEditor:1,autoCancel:!1,listeners:{canceledit:function(t,o){if(""===o.field){var r=e.grid.getSelectionModel();e.store.remove(r.getSelection()),e.store.getCount()>0&&r.select(0)}},validateedit:function(e,o){var a=o.newValues,n=o.record.data;if(console.log(a),console.log(n),""!==o.field){if(void 0!==i.cohorts[a.cohortname]&&a.cohortname!==n.cohortname)return t.startEdit(o.rowIdx,0),Ext.Msg.alert("Cohort name","Please choose a unique cohort name."),!1;var s=i.cohorts[i.selectedCohort];delete i.cohorts[n.cohortname],s.cohortname=a.cohortname,s.desc=a.briefdesc,s.bywho=a.bywho,s.datecreated=a.datecreated,i.cohorts[a.cohortname]=s}else{if(void 0!==i.cohorts[a.cohortname])return t.startEdit(o.rowIdx,0),Ext.Msg.alert("Cohort name","Please choose a unique cohort name."),!1;var d=new r(0);d.cohortname=a.cohortname,d.desc=a.briefdesc,d.bywho=a.bywho,d.datecreated=a.datecreated,i.cohorts[a.cohortname]=d}return i.selectedCohort=a.cohortname,Ext.getCmp("selected-cohort-text").update("Selected cohort: "+i.selectedCohort),!0}}});this.grid=Ext.create("Ext.grid.Panel",{store:e.store,renderTo:Ext.getBody(),layout:"fit",columns:[{header:"Cohort Name",dataIndex:"cohortname",width:150,align:"center",editor:{allowBlank:!1}},{header:"Brief Description",dataIndex:"briefdesc",width:150,align:"center",editor:{allowBlank:!1}},{xtype:"datecolumn",header:"Date Created",dataIndex:"datecreated",format:"d/m/Y H:i:s",width:150,align:"center",editable:!1},{header:"Created By",dataIndex:"bywho",width:150,align:"center",editor:{allowBlank:!1}},{text:"Define Cohort",width:150,align:"center",stopSelection:!0,xtype:"widgetcolumn",widget:{xtype:"button",_btnText:"Define",defaultBindProperty:null,handler:function(t){var o=t.getWidgetRecord();e.grid.getSelectionModel().select(o),i.slectedCohort=o.data.cohortname;var r=new a.DefineTabs(i.cohorts[i.selectedCohort]);r.window.show(),i.cohorts[o.data.cohortname]=r.cohort},listeners:{beforerender:function(e){e.setText(e._btnText)}}}}],tbar:[{text:"Add Cohort",renderTo:Ext.getBody(),handler:function(){if(t.editing)return void Ext.Msg.alert("Add cohort","Please finish editing first by pressing 'Update'");var o="Name "+i.chtCounter;i.chtCounter+=1;var r=Ext.create("CohortSelectorModel",{cohortname:o,briefdesc:"Brief description",datecreated:new Date,bywho:"User"});e.store.sort("datecreated","DESC"),e.grid.getStore().insert(0,r),t.startEdit(0,0)}},{itemId:"removeCohort",text:"Remove Cohort",handler:function(){var o=e.grid.getSelectionModel();return t.cancelEdit(),"Default"===o.getSelection()[0].data.cohortname?void Ext.Msg.alert("Default Cohort","You can't remove 'Default' cohort"):(delete i.cohorts[o.getSelection()[0].data.cohortname],e.store.remove(o.getSelection()),void(e.store.getCount()>0&&o.select(0)))},disabled:!0}],selType:"checkboxmodel",selModel:{id:"cohort-selModel",injectCheckbox:0,mode:"SINGLE",pruneRemoved:!0},plugins:[t],listeners:{selectionchange:function(t,o){o.length>0&&(i.selectedCohort=o[0].data.cohortname,Ext.getCmp("selected-cohort-text").update("Selected cohort: "+i.selectedCohort)),e.grid.down("#removeCohort").setDisabled(!o.length)}}}),this.window=new Ext.window.Window({height:300,width:790,title:"Select Cohort",layout:"fit",items:e.grid,closable:!1,modal:!0,resizeHandler:"n",buttons:[{text:"OK",handler:function(t){var o=e.grid.getSelection();i.selectedCohort=o[0].data.cohortname,e.window.hide(),i.patient_info.changeCohort(i.cohorts[i.selectedCohort]),i.count_info.changeCount("Diagnosis")}}],listeners:{afterrender:function(t,o){var r=e.store.getAt(0);e.grid.getSelectionModel().select(r)}}})}}),require.register("scripts/local.js",function(e,t,o){o.exports={}}),require.register("scripts/main.js",function(e,t,o){"use strict";var r=t("scripts/cohort"),i=t("scripts/cohort_selector"),a=t("scripts/patient_info"),n=t("scripts/cohort_details_counts"),s=t("scripts/local");Ext.require(["Ext.grid.*","Ext.data.*","Ext.panel.*","Ext.tab.Panel","Ext.form.FieldSet","Ext.layout.container.Border","Ext.layout.container.Accordion"]),s.cohorts=[],s.chtCounter=1,s.selectedCohort="Default",s.patient_info=null,s.cohort_selector=null,s.count_info=null;var d={init:function(){var e=new r(0);s.cohorts[s.selectedCohort]=e,s.cohort_selector=new i,s.patient_info=new a,s.count_info=new n;var t=Ext.create("Ext.Button",{text:"COHORT",renderTo:Ext.getBody(),frame:!0,handler:function(){s.cohort_selector.window.show()}});new Ext.window.Window({height:Ext.getBody().getViewSize().height,width:Ext.getBody().getViewSize().width,title:"Mujo Portal",layout:"border",closable:!1,draggable:!1,items:[{region:"west",title:"Cohort Details",xtype:"panel",margins:"50 50 50 50",split:!1,width:350,collapsed:!0,collapsible:!0,id:"west-region-container",layout:"accordion",items:[{title:"Patient Information",scrollable:!0,items:s.patient_info.grid},{title:"Counts",scrollable:!0,items:s.count_info.grid}]},{region:"center",id:"center-region-container",title:"Analytics",xtype:"panel",html:"Analytics here",scrollable:!0,tbar:[{text:"Compliance",handler:function(){Ext.getCmp("center-region-container").update("<center>Updating</center>"),Ext.getCmp("center-region-container").mask("Building Compliance Report..."),Ext.Ajax.request({url:"cohort_summary.php",params:s.cohorts[s.selectedCohort].getAjaxParams(),method:"GET",success:function(e,t){Ext.getCmp("center-region-container").update(e.responseText),Ext.getCmp("center-region-container").unmask()},failure:function(e,t){console.log("server-side failure with status code "+e.status)}})}}]},{region:"south",xtype:"panel",collapsible:!1,split:!1,layout:"fit",id:"selected-cohort-text",html:"Selected cohort: "+s.selectedCohort}],tbar:{items:[t]}}).show(),s.patient_info.store.load(),s.count_info.store.load(),s.cohort_selector.store.load()}};o.exports=d}),require.register("scripts/patient_info.js",function(e,t,o){"use strict";var r=t("scripts/local");Ext.define("PatientInfoModel",{extend:"Ext.data.Model",fields:[{name:"userId",type:"number"},{name:"gender",type:"number"},{name:"dateOfBirth",type:"date"},"diagnosis"]}),o.exports=function(){var e=this;this.store=Ext.create("Ext.data.Store",{autoDestroy:!0,model:"PatientInfoModel",proxy:{type:"ajax",url:"patient_info.php",extraParams:r.cohorts[r.selectedCohort].getAjaxParams(),reader:{type:"json"}},sorters:[{property:"userId",direction:"ASC"}]}),this.grid=Ext.create("Ext.grid.Panel",{id:"patient-info-grid",store:e.store,columns:[{xtype:"numbercolumn",format:"0",header:"Patient ID",dataIndex:"userId",flex:1,width:50,editor:{allowBlank:!1}},{header:"Gender",dataIndex:"gender",width:100,editor:{allowBlank:!1}},{xtype:"datecolumn",header:"Date of Birth",dataIndex:"dateOfBirth",width:135,editor:{xtype:"datefield",allowBlank:!1,format:"d/m/Y",minValue:"01/01/1900",minText:"Cannot be so old?!",maxValue:Ext.Date.format(new Date,"d/m/Y")}}]}),this.changeCohort=function(t){e.store.proxy.extraParams=t.getAjaxParams(),e.store.load()}}}),require.register("templates/listOfPeople.jade",function(e,t,o){var r=function(e){var t,o=[],r={},i=e||{};return function(e,i,a){r.person=t=function(r){this&&this.block,this&&this.attributes||{};o.push('<tr class="person"><td>'+jade.escape(null==(t=r.name)?"":t)+"</td><td>"+jade.escape(null==(t="m"===r.sex.toLowerCase()?"Male":"Female")?"":t)+"</td><td>"+jade.escape(null==(t=(new e).getFullYear()-new e(r.dob).getFullYear())?"":t)+"</td></tr>")},o.push('<p>A dynamically added table from jade templates:</p><table class="pure-table"><thead><tr><th>Name</th><th>Sex</th><th>Age</th></tr></thead><tbody>'),function(){var e=i;if("number"==typeof e.length)for(var t=0,o=e.length;o>t;t++){var a=e[t];r.person(a)}else{var o=0;for(var t in e){o++;var a=e[t];r.person(a)}}}.call(this),o.push("</tbody></table>")}.call(this,"Date"in i?i.Date:"undefined"!=typeof Date?Date:void 0,"people"in i?i.people:"undefined"!=typeof people?people:void 0,"undefined"in i?i.undefined:void 0),o.join("")};"function"==typeof define&&define.amd?define([],function(){return r}):"object"==typeof o&&o&&o.exports&&(o.exports=r)}),require.register("templates/partials/person.jade",function(e,t,o){var r=function(e){var t=[];return t.join("")};"function"==typeof define&&define.amd?define([],function(){return r}):"object"==typeof o&&o&&o.exports&&(o.exports=r)}),require.register("___globals___",function(e,t,o){})}(),require("___globals___");